// @svizzle/barchart v0.2.0 - Â© 2020 nestauk (https://www.nesta.org.uk/)
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self)["@svizzle/barchart/BarchartV"]=e()}(this,(function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function o(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function l(t,e){t.appendChild(e)}function c(t,e,n){t.insertBefore(e,n||null)}function a(t){t.parentNode.removeChild(t)}function u(t){return document.createElement(t)}function s(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function d(t){return document.createTextNode(t)}function f(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function h(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function y(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}let g,p;function $(){if(void 0===g){g=!1;try{"undefined"!=typeof window&&window.parent&&window.parent.document}catch(t){g=!0}}return g}function v(t,e,n){t.classList[n?"add":"remove"](e)}function m(t){p=t}function b(){if(!p)throw new Error("Function called outside component initialization");return p}function k(){const t=b();return(e,n)=>{const r=t.$$.callbacks[e];if(r){const o=function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(e,n);r.slice().forEach(e=>{e.call(t,o)})}}}const x=[],w=[],C=[],S=[],T=Promise.resolve();let F=!1;function A(t){C.push(t)}let E=!1;const j=new Set;function K(){if(!E){E=!0;do{for(let t=0;t<x.length;t+=1){const e=x[t];m(e),O(e.$$)}for(x.length=0;w.length;)w.pop()();for(let t=0;t<C.length;t+=1){const e=C[t];j.has(e)||(j.add(e),e())}C.length=0}while(x.length);for(;S.length;)S.pop()();F=!1,E=!1,j.clear()}}function O(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(A)}}const z=new Set;function L(t,e){t&&t.i&&(z.delete(t),t.i(e))}function I(t,e){t.d(1),e.delete(t.key)}function M(t,e){-1===t.$$.dirty[0]&&(x.push(t),F||(F=!0,T.then(K)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function H(i,l,c,u,s,d,f=[-1]){const h=p;m(i);const y=l.props||{},g=i.$$={fragment:null,ctx:null,props:d,update:t,not_equal:s,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:[]),callbacks:n(),dirty:f};let $=!1;if(g.ctx=c?c(i,y,(t,e,...n)=>{const r=n.length?n[0]:e;return g.ctx&&s(g.ctx[t],g.ctx[t]=r)&&(g.bound[t]&&g.bound[t](r),$&&M(i,t)),e}):[],g.update(),$=!0,r(g.before_update),g.fragment=!!u&&u(g.ctx),l.target){if(l.hydrate){const t=function(t){return Array.from(t.childNodes)}(l.target);g.fragment&&g.fragment.l(t),t.forEach(a)}else g.fragment&&g.fragment.c();l.intro&&L(i.$$.fragment),function(t,n,i){const{fragment:l,on_mount:c,on_destroy:a,after_update:u}=t.$$;l&&l.m(n,i),A(()=>{const n=c.map(e).filter(o);a?a.push(...n):r(n),t.$$.on_mount=[]}),u.forEach(A)}(i,l.target,l.anchor),K()}m(h)}var N=W;function W(t,e){return t===e||(t!=t&&e!=e||{}.toString.call(t)=={}.toString.call(e)&&(t===Object(t)&&(!!t&&(Array.isArray(t)?function(t,e){var n=t.length;if(n!=e.length)return!1;for(var r=!0,o=0;o<n;o++)if(!W(t[o],e[o])){r=!1;break}return r}(t,e):"[object Object]"=={}.toString.call(t)?function(t,e){var n=Object.keys(t).sort(),r=Object.keys(e).sort(),o=n.length;if(o!=r.length)return!1;for(var i=0;i<o;i++){var l=n[i],c=r[i];if(l!=c||!W(t[l],e[c]))return!1}return!0}
/**
* @overview lamb - A lightweight, and docile, JavaScript library to help embracing functional programming.
* @author Andrea Scartabelli <andrea.scartabelli@gmail.com>
* @version 0.59.2
* @module lamb
* @license MIT
*/(t,e):function(t,e){return t.toString()===e.toString()}(t,e)))))}function V(t){return function(e,n){return t.call(this,e,n)}}function B(t){return t}function D(t){return e=+(e=t),((n=+(n=0))>(r=+(r=4294967295))?NaN:e<n?n:e>r?r:e)>>>0;var e,n,r}var R=Function.bind.bind(Function.call);function P(t,e){return function(n){return function(r){return e?t.call(this,r,n):t.call(this,n,r)}}}var q,G=(q=1,function(t,e,n){var r,o,i=D(t.length),l=1===q?0:i-1;if(3===arguments.length)r=i,o=n;else{if(0===i)throw new TypeError("Reduce of empty array-like with no initial value");o=t[l],l+=q,r=i-1}for(;r--;l+=q)o=e(o,t[l],l,t);return o});function J(t){var e=+t;return e!=e?0:e%1==0?e:Math.floor(Math.abs(e))*(e<0?-1:1)}var Q=Object.prototype.toString;function U(t,e){for(var n,r,o=!1,i=0,l=t.length;i<l;i++)if(n=e,r=t[i],n!=n?r!=r:n===r){o=!0;break}return o}function X(t){return function(e){for(var n,r=[],o=0,i=e.length,l=[];o<i;o++)U(l,n=t(e[o],o,e))||(l.push(n),r.push(e[o]));return r}}var Y=P((function(t,e){return function(t,e,n){var r=D(t.length),o=J(e),i=J(n);o<0&&(o=o<-r?0:o+r),i<0?i=i<-r?0:i+r:i>r&&(i=r);for(var l=i-o,c=l>0?Array(l):[],a=0;a<l;a++)c[a]=t[o+a];return c}(t,e,t.length)}),!0);var Z,tt=P((function(t,e){return G(t,(function(t,n,r,o){var i=e(n,r,o);Array.isArray(i)||(i=[i]);for(var l=0,c=i.length,a=t.length;l<c;l++)t[a+l]=i[l];return t}),[])}),!0),et=(Z=function(t,e){return e},function(t,e){for(var n,r,o={},i=t.length,l=0;l<i;l++)o[r=e(n=t[l],l,t)]=Z(o[r],n);return o});var nt,rt=(nt=0,function(){for(var t=arguments.length||nt,e=t-nt,n=Array(e),r=0;r<e;r++)n[r]=arguments[r+nt];return n});function ot(t,e){return new TypeError("Cannot convert "+function(t){return Q.call(t).slice(8,-1)}(t).toLowerCase()+" to "+e)}var it;it=B,function(t){if(!Array.isArray(t))throw ot(t,"array");var e=t.length}([V(rt),tt(Y(0)),X(it)]),R(Object.prototype.propertyIsEnumerable),R(Object.prototype.hasOwnProperty),V(R(String.prototype.split)),R(String.prototype.search);function lt(t,e,n){const r=t.slice();return r[50]=e[n].barColor,r[51]=e[n].bkgColor,r[52]=e[n].displayValue,r[53]=e[n].dxKey,r[54]=e[n].isNeg,r[55]=e[n].key,r[56]=e[n].label,r[57]=e[n].x,r[58]=e[n].xValue,r[60]=n,r}function ct(t){let e,n,r;return{c(){e=u("header"),n=u("h2"),r=d(t[3]),h(n,"class","svelte-79144u"),h(e,"class","svelte-79144u")},m(t,o){c(t,e,o),l(e,n),l(n,r)},p(t,e){8&e[0]&&y(r,t[3])},d(t){t&&a(e)}}}function at(t,e){let n,i,u,g,p,$,m,b,k,x,w,C,S,T,_,F=e[56]+"",A=e[52]+"";return{key:t,first:null,c(){n=s("g"),i=s("rect"),g=s("line"),m=s("text"),b=d(F),x=s("text"),w=d(A),h(i,"width",e[6]),h(i,"fill",u=e[51]),h(i,"height",e[9]),h(g,"stroke",p=e[50]),h(g,"stroke-width",e[0]),h(g,"x1",e[14]),h(g,"x2",$=e[57]),h(g,"y1",e[10]),h(g,"y2",e[10]),h(m,"class","key svelte-79144u"),h(m,"dx",k=e[53]),h(m,"x",e[14]),h(m,"y",e[11]),v(m,"neg",e[54]),h(x,"class","value svelte-79144u"),h(x,"x",C=e[58]),h(x,"y",e[11]),v(x,"neg",e[54]),h(n,"class","item svelte-79144u"),h(n,"transform",S="translate(0, "+e[9]*e[60]+")"),v(n,"clickable",e[1]),this.first=n},m(t,r){c(t,n,r),l(n,i),l(n,g),l(n,m),l(m,b),l(n,x),l(x,w),T||(_=[f(n,"click",(function(){o(e[16](e[55]))&&e[16](e[55]).apply(this,arguments)})),f(n,"mouseenter",(function(){o(e[17](e[55]))&&e[17](e[55]).apply(this,arguments)})),f(n,"mouseleave",(function(){o(e[18](e[55]))&&e[18](e[55]).apply(this,arguments)}))],T=!0)},p(t,r){e=t,64&r[0]&&h(i,"width",e[6]),32768&r[0]&&u!==(u=e[51])&&h(i,"fill",u),512&r[0]&&h(i,"height",e[9]),32768&r[0]&&p!==(p=e[50])&&h(g,"stroke",p),1&r[0]&&h(g,"stroke-width",e[0]),16384&r[0]&&h(g,"x1",e[14]),32768&r[0]&&$!==($=e[57])&&h(g,"x2",$),1024&r[0]&&h(g,"y1",e[10]),1024&r[0]&&h(g,"y2",e[10]),32768&r[0]&&F!==(F=e[56]+"")&&y(b,F),32768&r[0]&&k!==(k=e[53])&&h(m,"dx",k),16384&r[0]&&h(m,"x",e[14]),2048&r[0]&&h(m,"y",e[11]),32768&r[0]&&v(m,"neg",e[54]),32768&r[0]&&A!==(A=e[52]+"")&&y(w,A),32768&r[0]&&C!==(C=e[58])&&h(x,"x",C),2048&r[0]&&h(x,"y",e[11]),32768&r[0]&&v(x,"neg",e[54]),33280&r[0]&&S!==(S="translate(0, "+e[9]*e[60]+")")&&h(n,"transform",S),2&r[0]&&v(n,"clickable",e[1])},d(t){t&&a(n),T=!1,r(_)}}}function ut(t){let e,n;return{c(){e=s("line"),h(e,"stroke",n=t[2].axisColor),h(e,"x1",t[14]),h(e,"x2",t[14]),h(e,"y2",t[12])},m(t,n){c(t,e,n)},p(t,r){4&r[0]&&n!==(n=t[2].axisColor)&&h(e,"stroke",n),16384&r[0]&&h(e,"x1",t[14]),16384&r[0]&&h(e,"x2",t[14]),4096&r[0]&&h(e,"y2",t[12])},d(t){t&&a(e)}}}function st(e){let n,r,o,i,y,g,p,m,b,k=[],x=new Map,w=e[3]&&ct(e),C=e[15];const S=t=>t[55];for(let t=0;t<C.length;t+=1){let n=lt(e,C,t),r=S(n);x.set(r,k[t]=at(r,n))}let T=e[13]&&ut(e);return{c(){n=u("div"),w&&w.c(),r=d(" "),o=u("main"),i=s("svg"),y=s("rect"),g=s("g");for(let t=0;t<k.length;t+=1)k[t].c();T&&T.c(),h(y,"class","bkg svelte-79144u"),h(y,"width",e[6]),h(y,"height",e[12]),h(i,"width",e[6]),h(i,"height",e[12]),h(o,"class","svelte-79144u"),A(()=>e[29].call(o)),v(o,"titled",e[3]),h(n,"style",e[8]),h(n,"class","BarchartVDiv svelte-79144u")},m(t,s){c(t,n,s),w&&w.m(n,null),l(n,r),l(n,o),l(o,i),l(i,y),l(i,g);for(let t=0;t<k.length;t+=1)k[t].m(g,null);T&&T.m(i,null),p=function(t,e){const n=getComputedStyle(t),r=(parseInt(n.zIndex)||0)-1;"static"===n.position&&(t.style.position="relative");const o=u("iframe");o.setAttribute("style",`display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: ${r};`),o.setAttribute("aria-hidden","true"),o.tabIndex=-1;const i=$();let c;return i?(o.src="data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}<\/script>",c=f(window,"message",t=>{t.source===o.contentWindow&&e()})):(o.src="about:blank",o.onload=()=>{c=f(o.contentWindow,"resize",e)}),l(t,o),()=>{(i||c&&o.contentWindow)&&c(),a(o)}}(o,e[29].bind(o)),e[30](o),m||(b=f(o,"mouseleave",e[31]),m=!0)},p(t,e){if(t[3]?w?w.p(t,e):(w=ct(t),w.c(),w.m(n,r)):w&&(w.d(1),w=null),64&e[0]&&h(y,"width",t[6]),4096&e[0]&&h(y,"height",t[12]),511555&e[0]){const n=t[15];k=function(t,e,n,r,o,i,l,c,a,u,s,d){let f=t.length,h=i.length,y=f;const g={};for(;y--;)g[t[y].key]=y;const p=[],$=new Map,v=new Map;for(y=h;y--;){const t=d(o,i,y),c=n(t);let a=l.get(c);a?r&&a.p(t,e):(a=u(c,t),a.c()),$.set(c,p[y]=a),c in g&&v.set(c,Math.abs(y-g[c]))}const m=new Set,b=new Set;function k(t){L(t,1),t.m(c,s),l.set(t.key,t),s=t.first,h--}for(;f&&h;){const e=p[h-1],n=t[f-1],r=e.key,o=n.key;e===n?(s=e.first,f--,h--):$.has(o)?!l.has(r)||m.has(r)?k(e):b.has(o)?f--:v.get(r)>v.get(o)?(b.add(r),k(e)):(m.add(o),f--):(a(n,l),f--)}for(;f--;){const e=t[f];$.has(e.key)||a(e,l)}for(;h;)k(p[h-1]);return p}(k,e,S,1,t,n,x,g,I,at,null,lt)}t[13]?T?T.p(t,e):(T=ut(t),T.c(),T.m(i,null)):T&&(T.d(1),T=null),64&e[0]&&h(i,"width",t[6]),4096&e[0]&&h(i,"height",t[12]),8&e[0]&&v(o,"titled",t[3]),256&e[0]&&h(n,"style",t[8])},i:t,o:t,d(t){t&&a(n),w&&w.d();for(let t=0;t<k.length;t+=1)k[t].d();T&&T.d(),p(),e[30](null),m=!1,b()}}}function dt(t,e,n){const r=_.getKey("key"),o=_.getKey("value"),i=_.pipe([_.skipIf(_.isNil),_.pairs,_.mapWith(_.pipe([joinWithColon,prepend("--")])),joinWithSemicolon]),l=k(),c={backgroundOpacity:1,axisColor:"grey",backgroundColor:"rgba(0,0,0,0)",barDefaultColor:"black",focusedKeyColor:"rgba(0, 0, 0, 0.1)",fontSize:14,headerHeight:"2rem",hoverColor:"rgba(0, 0, 0, 0.05)",padding:"10px",textColor:"grey"};let a,u,s,d,f,h,{barHeight:y}=e,{focusedKey:g}=e,{formatFn:p}=e,{isInteractive:$}=e,{items:v}=e,{keyToColor:m}=e,{keyToColorFn:x}=e,{keyToLabel:C}=e,{keyToLabelFn:S}=e,{shouldResetScroll:T}=e,{shouldScrollToFocusedKey:F}=e,{theme:A}=e,{title:E}=e,{valueAccessor:j}=e;var K;K=()=>{n(33,h=!T)},b().$$.before_update.push(K);let O,z,L,I,M,H,W,V,B,D,R,P,q,G,J,Q,U;return t.$set=t=>{"barHeight"in t&&n(0,y=t.barHeight),"focusedKey"in t&&n(21,g=t.focusedKey),"formatFn"in t&&n(22,p=t.formatFn),"isInteractive"in t&&n(1,$=t.isInteractive),"items"in t&&n(23,v=t.items),"keyToColor"in t&&n(24,m=t.keyToColor),"keyToColorFn"in t&&n(25,x=t.keyToColorFn),"keyToLabel"in t&&n(26,C=t.keyToLabel),"keyToLabelFn"in t&&n(27,S=t.keyToLabelFn),"shouldResetScroll"in t&&n(19,T=t.shouldResetScroll),"shouldScrollToFocusedKey"in t&&n(28,F=t.shouldScrollToFocusedKey),"theme"in t&&n(2,A=t.theme),"title"in t&&n(3,E=t.title),"valueAccessor"in t&&n(20,j=t.valueAccessor)},t.$$.update=()=>{if(1&t.$$.dirty[0]&&n(0,y=y||4),2&t.$$.dirty[0]&&n(1,$=$||!1),524288&t.$$.dirty[0]&&n(19,T=T||!1),4&t.$$.dirty[0]&&n(2,A=A?{...c,...A}:c),1048576&t.$$.dirty[0]&&n(20,j=j||o),4&t.$$.dirty[0]&&n(8,O=i(A)),4&t.$$.dirty[0]&&n(34,z=A.fontSize/2),5&t.$$.dirty[0]|8&t.$$.dirty[1]&&n(9,L=A.fontSize+y+3*z),513&t.$$.dirty[0]|8&t.$$.dirty[1]&&n(10,I=L-z-y/2),513&t.$$.dirty[0]|8&t.$$.dirty[1]&&n(11,M=L-y-2*z),8389120&t.$$.dirty[0]&&n(12,H=L*v.length),1048576&t.$$.dirty[0]&&n(35,W=(t=>_.reduceWith((e,n)=>{const r=t(n);return r<e?r:e},1/0))(j)),1048576&t.$$.dirty[0]&&n(36,V=(t=>_.reduceWith((e,n)=>{const r=t(n);return r>e?r:e},-1/0))(j)),8388608&t.$$.dirty[0]|16&t.$$.dirty[1]&&n(37,B=W(v)),8388608&t.$$.dirty[0]|32&t.$$.dirty[1]&&n(38,D=V(v)),192&t.$$.dirty[1]&&n(13,R=Math.sign(B)!==Math.sign(D)),8192&t.$$.dirty[0]|192&t.$$.dirty[1]&&n(39,P=R?[B,D]:D>0?[0,D]:[B,0]),64&t.$$.dirty[0]|256&t.$$.dirty[1]&&n(40,q=function t(e,n){var r=e[0],o=n[0],i=(n[1]-o)/(e[1]-r);return Object.assign((function(t){return o+(t-r)*i}),{inverse:function(){return t(n,e)}})}(P,[0,s])),512&t.$$.dirty[1]&&n(14,G=q(0)),267395684&t.$$.dirty[0]|520&t.$$.dirty[1]&&n(15,J=v.map((t,e)=>{const n=j(t),r=n<0;return{...t,barColor:m?m[t.key]||A.barDefaultColor:x?x(t.key):A.barDefaultColor,bkgColor:t.key===g?A.focusedKeyColor:t.key===u?A.hoverColor:"rgba(0,0,0,0)",displayValue:p?p(n):n,dxKey:R?r?-z:z:0,isNeg:r,label:C&&C[t.key]?C[t.key]:S?S(t.key):t.key,x:q(n),xValue:n>0?s:0,y:(e+1)*L}})),32768&t.$$.dirty[0]&&n(41,Q=et(J,r)),8912896&t.$$.dirty[0]|2&t.$$.dirty[1]&&function(t){b().$$.after_update.push(t)}(()=>{v&&T&&!N(d,v)&&(n(7,f.scrollTop=0,f),n(32,d=v))}),524416&t.$$.dirty[0]|4&t.$$.dirty[1]&&h&&T&&f&&n(7,f.scrollTop=0,f),270532608&t.$$.dirty[0]|1024&t.$$.dirty[1]&&n(42,U=F&&g&&Q[g]&&Q[g].y),270533264&t.$$.dirty[0]|2048&t.$$.dirty[1]&&F&&g&&f){const t=-f.scrollTop+U;t<0?f.scroll({top:U-L,behavior:"smooth"}):t>a&&f.scroll({top:U-a,behavior:"smooth"})}},[y,$,A,E,a,u,s,f,O,L,I,M,H,R,G,J,t=>()=>{$&&l("clicked",{id:t})},t=>()=>{$&&l("entered",{id:t}),n(5,u=t)},t=>()=>{$&&l("exited",{id:t})},T,j,g,p,v,m,x,C,S,F,function(){s=this.clientWidth,a=this.clientHeight,n(6,s),n(4,a)},function(t){w[t?"unshift":"push"](()=>{f=t,n(7,f),n(23,v),n(19,T),n(32,d),n(33,h)})},()=>{n(5,u=null)}]}return class extends class{$destroy(){!function(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}{constructor(t){var e;super(),document.getElementById("svelte-79144u-style")||((e=u("style")).id="svelte-79144u-style",e.textContent=".BarchartVDiv.svelte-79144u.svelte-79144u{width:100%;height:100%;padding:var(--padding)}header.svelte-79144u.svelte-79144u{width:100%;height:var(--headerHeight);display:flex;align-items:center}h2.svelte-79144u.svelte-79144u{margin:0}main.svelte-79144u.svelte-79144u{width:100%;height:100%;max-height:100%;overflow-y:auto}main.titled.svelte-79144u.svelte-79144u{height:calc(100% - var(--headerHeight));max-height:calc(100% - var(--headerHeight))}rect.bkg.svelte-79144u.svelte-79144u{fill-opacity:var(--backgroundOpacity);fill:var(--backgroundColor)}.item.clickable.svelte-79144u.svelte-79144u{cursor:pointer}.item.svelte-79144u text.svelte-79144u{fill:var(--textColor);font-size:var(--fontSize);stroke:none}.item.svelte-79144u text.key.neg.svelte-79144u{text-anchor:end}.item.svelte-79144u text.value.svelte-79144u{text-anchor:end}.item.svelte-79144u text.value.neg.svelte-79144u{text-anchor:start}",l(document.head,e)),H(this,t,dt,st,i,{barHeight:0,focusedKey:21,formatFn:22,isInteractive:1,items:23,keyToColor:24,keyToColorFn:25,keyToLabel:26,keyToLabelFn:27,shouldResetScroll:19,shouldScrollToFocusedKey:28,theme:2,title:3,valueAccessor:20},[-1,-1])}}}));
