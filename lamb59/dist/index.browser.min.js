// @svizzle/barchart v0.2.0 - Â© 2020 nestauk (https://www.nesta.org.uk/)
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self)["@svizzle/barchart/index"]={})}(this,(function(t){"use strict";function e(){}function n(t){return t()}function r(){return Object.create(null)}function o(t){t.forEach(n)}function i(t){return"function"==typeof t}function l(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function c(t,e){t.appendChild(e)}function a(t,e,n){t.insertBefore(e,n||null)}function s(t){t.parentNode.removeChild(t)}function u(t){return document.createElement(t)}function d(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function f(t){return document.createTextNode(t)}function h(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function y(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function p(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}let g,v;function $(){if(void 0===g){g=!1;try{"undefined"!=typeof window&&window.parent&&window.parent.document}catch(t){g=!0}}return g}function m(t,e,n){t.classList[n?"add":"remove"](e)}function b(t){v=t}function k(){if(!v)throw new Error("Function called outside component initialization");return v}function x(){const t=k();return(e,n)=>{const r=t.$$.callbacks[e];if(r){const o=function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(e,n);r.slice().forEach(e=>{e.call(t,o)})}}}const w=[],C=[],S=[],T=[],F=Promise.resolve();let A=!1;function E(t){S.push(t)}let j=!1;const K=new Set;function O(){if(!j){j=!0;do{for(let t=0;t<w.length;t+=1){const e=w[t];b(e),z(e.$$)}for(w.length=0;C.length;)C.pop()();for(let t=0;t<S.length;t+=1){const e=S[t];K.has(e)||(K.add(e),e())}S.length=0}while(w.length);for(;T.length;)T.pop()();A=!1,j=!1,K.clear()}}function z(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(E)}}const L=new Set;function M(t,e){t&&t.i&&(L.delete(t),t.i(e))}function I(t,e){t.d(1),e.delete(t.key)}function H(t,e){-1===t.$$.dirty[0]&&(w.push(t),A||(A=!0,F.then(O)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function N(t,l,c,a,u,d,f=[-1]){const h=v;b(t);const y=l.props||{},p=t.$$={fragment:null,ctx:null,props:d,update:e,not_equal:u,bound:r(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:[]),callbacks:r(),dirty:f};let g=!1;if(p.ctx=c?c(t,y,(e,n,...r)=>{const o=r.length?r[0]:n;return p.ctx&&u(p.ctx[e],p.ctx[e]=o)&&(p.bound[e]&&p.bound[e](o),g&&H(t,e)),n}):[],p.update(),g=!0,o(p.before_update),p.fragment=!!a&&a(p.ctx),l.target){if(l.hydrate){const t=function(t){return Array.from(t.childNodes)}(l.target);p.fragment&&p.fragment.l(t),t.forEach(s)}else p.fragment&&p.fragment.c();l.intro&&M(t.$$.fragment),function(t,e,r){const{fragment:l,on_mount:c,on_destroy:a,after_update:s}=t.$$;l&&l.m(e,r),E(()=>{const e=c.map(n).filter(i);a?a.push(...e):o(e),t.$$.on_mount=[]}),s.forEach(E)}(t,l.target,l.anchor),O()}b(h)}var W=V;function V(t,e){return t===e||(t!=t&&e!=e||{}.toString.call(t)=={}.toString.call(e)&&(t===Object(t)&&(!!t&&(Array.isArray(t)?function(t,e){var n=t.length;if(n!=e.length)return!1;for(var r=!0,o=0;o<n;o++)if(!V(t[o],e[o])){r=!1;break}return r}(t,e):"[object Object]"=={}.toString.call(t)?function(t,e){var n=Object.keys(t).sort(),r=Object.keys(e).sort(),o=n.length;if(o!=r.length)return!1;for(var i=0;i<o;i++){var l=n[i],c=r[i];if(l!=c||!V(t[l],e[c]))return!1}return!0}
/**
* @overview lamb - A lightweight, and docile, JavaScript library to help embracing functional programming.
* @author Andrea Scartabelli <andrea.scartabelli@gmail.com>
* @version 0.59.2
* @module lamb
* @license MIT
*/(t,e):function(t,e){return t.toString()===e.toString()}(t,e)))))}function D(t){return function(e,n){return t.call(this,e,n)}}function B(t){return t}function R(t){return e=+(e=t),((n=+(n=0))>(r=+(r=4294967295))?NaN:e<n?n:e>r?r:e)>>>0;var e,n,r}var P=Function.bind.bind(Function.call);function q(t,e){return function(n){return function(r){return e?t.call(this,r,n):t.call(this,n,r)}}}var G,J=(G=1,function(t,e,n){var r,o,i=R(t.length),l=1===G?0:i-1;if(3===arguments.length)r=i,o=n;else{if(0===i)throw new TypeError("Reduce of empty array-like with no initial value");o=t[l],l+=G,r=i-1}for(;r--;l+=G)o=e(o,t[l],l,t);return o});function Q(t){var e=+t;return e!=e?0:e%1==0?e:Math.floor(Math.abs(e))*(e<0?-1:1)}var U=Object.prototype.toString;function X(t,e){for(var n,r,o=!1,i=0,l=t.length;i<l;i++)if(n=e,r=t[i],n!=n?r!=r:n===r){o=!0;break}return o}function Y(t){return function(e){for(var n,r=[],o=0,i=e.length,l=[];o<i;o++)X(l,n=t(e[o],o,e))||(l.push(n),r.push(e[o]));return r}}var Z=q((function(t,e){return function(t,e,n){var r=R(t.length),o=Q(e),i=Q(n);o<0&&(o=o<-r?0:o+r),i<0?i=i<-r?0:i+r:i>r&&(i=r);for(var l=i-o,c=l>0?Array(l):[],a=0;a<l;a++)c[a]=t[o+a];return c}(t,e,t.length)}),!0);var tt,et=q((function(t,e){return J(t,(function(t,n,r,o){var i=e(n,r,o);Array.isArray(i)||(i=[i]);for(var l=0,c=i.length,a=t.length;l<c;l++)t[a+l]=i[l];return t}),[])}),!0),nt=(tt=function(t,e){return e},function(t,e){for(var n,r,o={},i=t.length,l=0;l<i;l++)o[r=e(n=t[l],l,t)]=tt(o[r],n);return o});var rt,ot=(rt=0,function(){for(var t=arguments.length||rt,e=t-rt,n=Array(e),r=0;r<e;r++)n[r]=arguments[r+rt];return n});function it(t,e){return new TypeError("Cannot convert "+function(t){return U.call(t).slice(8,-1)}(t).toLowerCase()+" to "+e)}var lt;lt=B,function(t){if(!Array.isArray(t))throw it(t,"array");var e=t.length}([D(ot),et(Z(0)),Y(lt)]),P(Object.prototype.propertyIsEnumerable),P(Object.prototype.hasOwnProperty),D(P(String.prototype.split)),P(String.prototype.search);function ct(t,e,n){const r=t.slice();return r[50]=e[n].barColor,r[51]=e[n].bkgColor,r[52]=e[n].displayValue,r[53]=e[n].dxKey,r[54]=e[n].isNeg,r[55]=e[n].key,r[56]=e[n].label,r[57]=e[n].x,r[58]=e[n].xValue,r[60]=n,r}function at(t){let e,n,r;return{c(){e=u("header"),n=u("h2"),r=f(t[3]),y(n,"class","svelte-79144u"),y(e,"class","svelte-79144u")},m(t,o){a(t,e,o),c(e,n),c(n,r)},p(t,e){8&e[0]&&p(r,t[3])},d(t){t&&s(e)}}}function st(t,e){let n,r,l,u,g,v,$,b,k,x,w,C,_,S,T,F=e[56]+"",A=e[52]+"";return{key:t,first:null,c(){n=d("g"),r=d("rect"),u=d("line"),$=d("text"),b=f(F),x=d("text"),w=f(A),y(r,"width",e[6]),y(r,"fill",l=e[51]),y(r,"height",e[9]),y(u,"stroke",g=e[50]),y(u,"stroke-width",e[0]),y(u,"x1",e[14]),y(u,"x2",v=e[57]),y(u,"y1",e[10]),y(u,"y2",e[10]),y($,"class","key svelte-79144u"),y($,"dx",k=e[53]),y($,"x",e[14]),y($,"y",e[11]),m($,"neg",e[54]),y(x,"class","value svelte-79144u"),y(x,"x",C=e[58]),y(x,"y",e[11]),m(x,"neg",e[54]),y(n,"class","item svelte-79144u"),y(n,"transform",_="translate(0, "+e[9]*e[60]+")"),m(n,"clickable",e[1]),this.first=n},m(t,o){a(t,n,o),c(n,r),c(n,u),c(n,$),c($,b),c(n,x),c(x,w),S||(T=[h(n,"click",(function(){i(e[16](e[55]))&&e[16](e[55]).apply(this,arguments)})),h(n,"mouseenter",(function(){i(e[17](e[55]))&&e[17](e[55]).apply(this,arguments)})),h(n,"mouseleave",(function(){i(e[18](e[55]))&&e[18](e[55]).apply(this,arguments)}))],S=!0)},p(t,o){e=t,64&o[0]&&y(r,"width",e[6]),32768&o[0]&&l!==(l=e[51])&&y(r,"fill",l),512&o[0]&&y(r,"height",e[9]),32768&o[0]&&g!==(g=e[50])&&y(u,"stroke",g),1&o[0]&&y(u,"stroke-width",e[0]),16384&o[0]&&y(u,"x1",e[14]),32768&o[0]&&v!==(v=e[57])&&y(u,"x2",v),1024&o[0]&&y(u,"y1",e[10]),1024&o[0]&&y(u,"y2",e[10]),32768&o[0]&&F!==(F=e[56]+"")&&p(b,F),32768&o[0]&&k!==(k=e[53])&&y($,"dx",k),16384&o[0]&&y($,"x",e[14]),2048&o[0]&&y($,"y",e[11]),32768&o[0]&&m($,"neg",e[54]),32768&o[0]&&A!==(A=e[52]+"")&&p(w,A),32768&o[0]&&C!==(C=e[58])&&y(x,"x",C),2048&o[0]&&y(x,"y",e[11]),32768&o[0]&&m(x,"neg",e[54]),33280&o[0]&&_!==(_="translate(0, "+e[9]*e[60]+")")&&y(n,"transform",_),2&o[0]&&m(n,"clickable",e[1])},d(t){t&&s(n),S=!1,o(T)}}}function ut(t){let e,n;return{c(){e=d("line"),y(e,"stroke",n=t[2].axisColor),y(e,"x1",t[14]),y(e,"x2",t[14]),y(e,"y2",t[12])},m(t,n){a(t,e,n)},p(t,r){4&r[0]&&n!==(n=t[2].axisColor)&&y(e,"stroke",n),16384&r[0]&&y(e,"x1",t[14]),16384&r[0]&&y(e,"x2",t[14]),4096&r[0]&&y(e,"y2",t[12])},d(t){t&&s(e)}}}function dt(t){let n,r,o,i,l,p,g,v,b,k=[],x=new Map,w=t[3]&&at(t),C=t[15];const _=t=>t[55];for(let e=0;e<C.length;e+=1){let n=ct(t,C,e),r=_(n);x.set(r,k[e]=st(r,n))}let S=t[13]&&ut(t);return{c(){n=u("div"),w&&w.c(),r=f(" "),o=u("main"),i=d("svg"),l=d("rect"),p=d("g");for(let t=0;t<k.length;t+=1)k[t].c();S&&S.c(),y(l,"class","bkg svelte-79144u"),y(l,"width",t[6]),y(l,"height",t[12]),y(i,"width",t[6]),y(i,"height",t[12]),y(o,"class","svelte-79144u"),E(()=>t[29].call(o)),m(o,"titled",t[3]),y(n,"style",t[8]),y(n,"class","BarchartVDiv svelte-79144u")},m(e,d){a(e,n,d),w&&w.m(n,null),c(n,r),c(n,o),c(o,i),c(i,l),c(i,p);for(let t=0;t<k.length;t+=1)k[t].m(p,null);S&&S.m(i,null),g=function(t,e){const n=getComputedStyle(t),r=(parseInt(n.zIndex)||0)-1;"static"===n.position&&(t.style.position="relative");const o=u("iframe");o.setAttribute("style",`display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: ${r};`),o.setAttribute("aria-hidden","true"),o.tabIndex=-1;const i=$();let l;return i?(o.src="data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}<\/script>",l=h(window,"message",t=>{t.source===o.contentWindow&&e()})):(o.src="about:blank",o.onload=()=>{l=h(o.contentWindow,"resize",e)}),c(t,o),()=>{(i||l&&o.contentWindow)&&l(),s(o)}}(o,t[29].bind(o)),t[30](o),v||(b=h(o,"mouseleave",t[31]),v=!0)},p(t,e){if(t[3]?w?w.p(t,e):(w=at(t),w.c(),w.m(n,r)):w&&(w.d(1),w=null),64&e[0]&&y(l,"width",t[6]),4096&e[0]&&y(l,"height",t[12]),511555&e[0]){const n=t[15];k=function(t,e,n,r,o,i,l,c,a,s,u,d){let f=t.length,h=i.length,y=f;const p={};for(;y--;)p[t[y].key]=y;const g=[],v=new Map,$=new Map;for(y=h;y--;){const t=d(o,i,y),c=n(t);let a=l.get(c);a?r&&a.p(t,e):(a=s(c,t),a.c()),v.set(c,g[y]=a),c in p&&$.set(c,Math.abs(y-p[c]))}const m=new Set,b=new Set;function k(t){M(t,1),t.m(c,u),l.set(t.key,t),u=t.first,h--}for(;f&&h;){const e=g[h-1],n=t[f-1],r=e.key,o=n.key;e===n?(u=e.first,f--,h--):v.has(o)?!l.has(r)||m.has(r)?k(e):b.has(o)?f--:$.get(r)>$.get(o)?(b.add(r),k(e)):(m.add(o),f--):(a(n,l),f--)}for(;f--;){const e=t[f];v.has(e.key)||a(e,l)}for(;h;)k(g[h-1]);return g}(k,e,_,1,t,n,x,p,I,st,null,ct)}t[13]?S?S.p(t,e):(S=ut(t),S.c(),S.m(i,null)):S&&(S.d(1),S=null),64&e[0]&&y(i,"width",t[6]),4096&e[0]&&y(i,"height",t[12]),8&e[0]&&m(o,"titled",t[3]),256&e[0]&&y(n,"style",t[8])},i:e,o:e,d(e){e&&s(n),w&&w.d();for(let t=0;t<k.length;t+=1)k[t].d();S&&S.d(),g(),t[30](null),v=!1,b()}}}function ft(t,e,n){const r=_.getKey("key"),o=_.getKey("value"),i=_.pipe([_.skipIf(_.isNil),_.pairs,_.mapWith(_.pipe([joinWithColon,prepend("--")])),joinWithSemicolon]),l=x(),c={backgroundOpacity:1,axisColor:"grey",backgroundColor:"rgba(0,0,0,0)",barDefaultColor:"black",focusedKeyColor:"rgba(0, 0, 0, 0.1)",fontSize:14,headerHeight:"2rem",hoverColor:"rgba(0, 0, 0, 0.05)",padding:"10px",textColor:"grey"};let a,s,u,d,f,h,{barHeight:y}=e,{focusedKey:p}=e,{formatFn:g}=e,{isInteractive:v}=e,{items:$}=e,{keyToColor:m}=e,{keyToColorFn:b}=e,{keyToLabel:w}=e,{keyToLabelFn:S}=e,{shouldResetScroll:T}=e,{shouldScrollToFocusedKey:F}=e,{theme:A}=e,{title:E}=e,{valueAccessor:j}=e;var K;K=()=>{n(33,h=!T)},k().$$.before_update.push(K);let O,z,L,M,I,H,N,V,D,B,R,P,q,G,J,Q,U;return t.$set=t=>{"barHeight"in t&&n(0,y=t.barHeight),"focusedKey"in t&&n(21,p=t.focusedKey),"formatFn"in t&&n(22,g=t.formatFn),"isInteractive"in t&&n(1,v=t.isInteractive),"items"in t&&n(23,$=t.items),"keyToColor"in t&&n(24,m=t.keyToColor),"keyToColorFn"in t&&n(25,b=t.keyToColorFn),"keyToLabel"in t&&n(26,w=t.keyToLabel),"keyToLabelFn"in t&&n(27,S=t.keyToLabelFn),"shouldResetScroll"in t&&n(19,T=t.shouldResetScroll),"shouldScrollToFocusedKey"in t&&n(28,F=t.shouldScrollToFocusedKey),"theme"in t&&n(2,A=t.theme),"title"in t&&n(3,E=t.title),"valueAccessor"in t&&n(20,j=t.valueAccessor)},t.$$.update=()=>{if(1&t.$$.dirty[0]&&n(0,y=y||4),2&t.$$.dirty[0]&&n(1,v=v||!1),524288&t.$$.dirty[0]&&n(19,T=T||!1),4&t.$$.dirty[0]&&n(2,A=A?{...c,...A}:c),1048576&t.$$.dirty[0]&&n(20,j=j||o),4&t.$$.dirty[0]&&n(8,O=i(A)),4&t.$$.dirty[0]&&n(34,z=A.fontSize/2),5&t.$$.dirty[0]|8&t.$$.dirty[1]&&n(9,L=A.fontSize+y+3*z),513&t.$$.dirty[0]|8&t.$$.dirty[1]&&n(10,M=L-z-y/2),513&t.$$.dirty[0]|8&t.$$.dirty[1]&&n(11,I=L-y-2*z),8389120&t.$$.dirty[0]&&n(12,H=L*$.length),1048576&t.$$.dirty[0]&&n(35,N=(t=>_.reduceWith((e,n)=>{const r=t(n);return r<e?r:e},1/0))(j)),1048576&t.$$.dirty[0]&&n(36,V=(t=>_.reduceWith((e,n)=>{const r=t(n);return r>e?r:e},-1/0))(j)),8388608&t.$$.dirty[0]|16&t.$$.dirty[1]&&n(37,D=N($)),8388608&t.$$.dirty[0]|32&t.$$.dirty[1]&&n(38,B=V($)),192&t.$$.dirty[1]&&n(13,R=Math.sign(D)!==Math.sign(B)),8192&t.$$.dirty[0]|192&t.$$.dirty[1]&&n(39,P=R?[D,B]:B>0?[0,B]:[D,0]),64&t.$$.dirty[0]|256&t.$$.dirty[1]&&n(40,q=function t(e,n){var r=e[0],o=n[0],i=(n[1]-o)/(e[1]-r);return Object.assign((function(t){return o+(t-r)*i}),{inverse:function(){return t(n,e)}})}(P,[0,u])),512&t.$$.dirty[1]&&n(14,G=q(0)),267395684&t.$$.dirty[0]|520&t.$$.dirty[1]&&n(15,J=$.map((t,e)=>{const n=j(t),r=n<0;return{...t,barColor:m?m[t.key]||A.barDefaultColor:b?b(t.key):A.barDefaultColor,bkgColor:t.key===p?A.focusedKeyColor:t.key===s?A.hoverColor:"rgba(0,0,0,0)",displayValue:g?g(n):n,dxKey:R?r?-z:z:0,isNeg:r,label:w&&w[t.key]?w[t.key]:S?S(t.key):t.key,x:q(n),xValue:n>0?u:0,y:(e+1)*L}})),32768&t.$$.dirty[0]&&n(41,Q=nt(J,r)),8912896&t.$$.dirty[0]|2&t.$$.dirty[1]&&function(t){k().$$.after_update.push(t)}(()=>{$&&T&&!W(d,$)&&(n(7,f.scrollTop=0,f),n(32,d=$))}),524416&t.$$.dirty[0]|4&t.$$.dirty[1]&&h&&T&&f&&n(7,f.scrollTop=0,f),270532608&t.$$.dirty[0]|1024&t.$$.dirty[1]&&n(42,U=F&&p&&Q[p]&&Q[p].y),270533264&t.$$.dirty[0]|2048&t.$$.dirty[1]&&F&&p&&f){const t=-f.scrollTop+U;t<0?f.scroll({top:U-L,behavior:"smooth"}):t>a&&f.scroll({top:U-a,behavior:"smooth"})}},[y,v,A,E,a,s,u,f,O,L,M,I,H,R,G,J,t=>()=>{v&&l("clicked",{id:t})},t=>()=>{v&&l("entered",{id:t}),n(5,s=t)},t=>()=>{v&&l("exited",{id:t})},T,j,p,g,$,m,b,w,S,F,function(){u=this.clientWidth,a=this.clientHeight,n(6,u),n(4,a)},function(t){C[t?"unshift":"push"](()=>{f=t,n(7,f),n(23,$),n(19,T),n(32,d),n(33,h)})},()=>{n(5,s=null)}]}t.BarchartVDiv=class extends class{$destroy(){!function(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=e}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}{constructor(t){var e;super(),document.getElementById("svelte-79144u-style")||((e=u("style")).id="svelte-79144u-style",e.textContent=".BarchartVDiv.svelte-79144u.svelte-79144u{width:100%;height:100%;padding:var(--padding)}header.svelte-79144u.svelte-79144u{width:100%;height:var(--headerHeight);display:flex;align-items:center}h2.svelte-79144u.svelte-79144u{margin:0}main.svelte-79144u.svelte-79144u{width:100%;height:100%;max-height:100%;overflow-y:auto}main.titled.svelte-79144u.svelte-79144u{height:calc(100% - var(--headerHeight));max-height:calc(100% - var(--headerHeight))}rect.bkg.svelte-79144u.svelte-79144u{fill-opacity:var(--backgroundOpacity);fill:var(--backgroundColor)}.item.clickable.svelte-79144u.svelte-79144u{cursor:pointer}.item.svelte-79144u text.svelte-79144u{fill:var(--textColor);font-size:var(--fontSize);stroke:none}.item.svelte-79144u text.key.neg.svelte-79144u{text-anchor:end}.item.svelte-79144u text.value.svelte-79144u{text-anchor:end}.item.svelte-79144u text.value.neg.svelte-79144u{text-anchor:start}",c(document.head,e)),N(this,t,ft,dt,l,{barHeight:0,focusedKey:21,formatFn:22,isInteractive:1,items:23,keyToColor:24,keyToColorFn:25,keyToLabel:26,keyToLabelFn:27,shouldResetScroll:19,shouldScrollToFocusedKey:28,theme:2,title:3,valueAccessor:20},[-1,-1])}},Object.defineProperty(t,"__esModule",{value:!0})}));
